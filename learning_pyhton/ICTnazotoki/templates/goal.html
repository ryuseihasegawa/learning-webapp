{% extends "base.html" %}
{% block content %}

<style>
    :root {
        --gold: #d4af37;
        --navy: #071427;
        --text: #eef6ff;
    }

    /* 背景（画像＋暗幕） */
    .goal-hero {
        position: relative;
        min-height: 92vh;
        overflow: hidden;
        background: linear-gradient(180deg, rgba(7, 20, 39, .72) 0%, rgba(7, 20, 39, .88) 70%, rgba(7, 20, 39, .96) 100%),
        url("{{ url_for('static', filename='tocho_fireworks.png') }}") center/cover no-repeat;
    }

    /* 控えめなきらめき */
    .goal-hero::before {
        content: "";
        position: absolute;
        inset: 0;
        background-image:
            radial-gradient(2px 2px at 15% 20%, rgba(255, 255, 255, .55), transparent 60%),
            radial-gradient(1.5px 1.5px at 70% 30%, rgba(255, 255, 255, .45), transparent 60%),
            radial-gradient(1.8px 1.8px at 40% 75%, rgba(255, 255, 255, .35), transparent 60%),
            radial-gradient(1px 1px at 85% 65%, rgba(255, 255, 255, .30), transparent 60%);
        opacity: .6;
        animation: twinkle 4.5s ease-in-out infinite alternate;
        pointer-events: none;
    }

    @keyframes twinkle {
        from {
            transform: translateY(0);
            opacity: .45;
            filter: brightness(1);
        }

        to {
            transform: translateY(10px);
            opacity: .65;
            filter: brightness(1.15);
        }
    }

    /* 紙吹雪キャンバス */
    #confettiCanvas {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    /* タイトル演出 */
    .goal-title {
        color: var(--gold);
        letter-spacing: .08em;
        font-weight: 800;
        text-shadow: 0 6px 24px rgba(0, 0, 0, .35);
        opacity: 0;
        transform: translateY(10px);
        animation: fadeUp .9s ease forwards;
    }

    .goal-subtitle {
        color: rgba(238, 246, 255, .85);
        opacity: 0;
        transform: translateY(10px);
        animation: fadeUp .9s .15s ease forwards;
    }

    @keyframes fadeUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ガラスカード風 */
    .glass {
        background: rgba(255, 255, 255, .08) !important;
        border: 1px solid rgba(255, 255, 255, .16) !important;
        backdrop-filter: blur(8px);
        box-shadow: 0 20px 55px rgba(0, 0, 0, .35);
        opacity: 0;
        transform: translateY(12px);
        animation: fadeUp .9s .25s ease forwards;
    }

    .badge-soft {
        border: 1px solid rgba(255, 255, 255, .18);
        background: rgba(255, 255, 255, .07);
        color: rgba(238, 246, 255, .92);
    }

    .badge-gold {
        border: 1px solid rgba(212, 175, 55, .45);
        background: rgba(212, 175, 55, .12);
        color: var(--gold);
        font-weight: 700;
    }

    /* ご褒美感のあるボタン */
    .btn-gold {
        background: linear-gradient(90deg, #ffd36a, var(--gold));
        border: 0;
        color: #071427;
        font-weight: 800;
        box-shadow: 0 14px 30px rgba(212, 175, 55, .22);
        position: relative;
        overflow: hidden;
    }

    .btn-gold::after {
        content: "";
        position: absolute;
        top: -50%;
        left: -35%;
        width: 35%;
        height: 200%;
        transform: rotate(20deg);
        background: rgba(255, 255, 255, .55);
        filter: blur(2px);
        animation: shine 2.8s ease-in-out infinite;
        opacity: 0;
    }

    @keyframes shine {
        0% {
            transform: translateX(-160%) rotate(20deg);
            opacity: 0;
        }

        18% {
            opacity: .45;
        }

        38% {
            transform: translateX(360%) rotate(20deg);
            opacity: 0;
        }

        100% {
            opacity: 0;
        }
    }

    .small-note {
        color: rgba(238, 246, 255, .70);
    }
</style>

<section class="goal-hero d-flex align-items-center">
    <canvas id="confettiCanvas"></canvas>

    <div class="container py-5 position-relative" style="z-index:2;">
        <div class="row justify-content-center">
            <div class="col-lg-9 col-xl-8">

                <!-- 見出し -->
                <div class="text-center mb-4">
                    <h1 class="goal-title display-5 mb-2">MISSION CONPLETE</h1>

                    <img src="{{ url_for('static', filename='congratulation.png') }}" class="img-fluid"
                        style="max-width: 720px; border-radius: 8px;">

                </div>

                <!-- 本文カード -->
                <div class="card glass mb-4">
                    <div class="card-body p-4 p-md-5">

                        <p class="mb-3" style="color: rgba(238,246,255,.88); line-height: 1.9;">
                            ICT職５期生の諸君。<br>
                            よくぞここまで辿り着いた。<br>
                            数々の謎、そのすべてを読み解き、このページに到達したという事実こそ、君たちの実力の証だ。<br>
                        </p>

                        <p class="mb-3" style="color: rgba(238,246,255,.88); line-height: 1.9;">
                            この研修を通じて問われたのは、単なる知識ではない。<br>
                            観察力、論理力、ひらめき、そして仲間との連携。<br>
                            それらを統合し、答えに辿り着いた諸君に、私は最大限の敬意を送る。
                        </p>


                        <p class="mb-4" style="color: rgba(238,246,255,.88); line-height: 1.9;">
                            最終問題に辿り着いた今、君たちは胸を張ってよい。<br>
                            「挑戦を完遂した者」として、次のステージに進む準備は整っている。
                        </p>


                        <!-- ボタン（ホームに戻るのみ） -->
                        <div class="d-flex justify-content-center">
                            <a href="{{ url_for('index') }}" class="btn btn-gold px-4 py-2">
                                ホームに戻る
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>

<script>
    /* 軽量・紙吹雪（外部ライブラリなし） */
    (() => {
        const canvas = document.getElementById("confettiCanvas");
        const ctx = canvas.getContext("2d");

        function resize() {
            const dpr = window.devicePixelRatio || 1;
            canvas.width = Math.floor(canvas.clientWidth * dpr);
            canvas.height = Math.floor(canvas.clientHeight * dpr);
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
        const W = () => canvas.clientWidth;
        const H = () => canvas.clientHeight;

        window.addEventListener("resize", resize);
        resize();

        const colors = ["#ffd36a", "#d4af37", "#7cc6ff", "#ffffff", "#ff6b9a"];
        const pieces = [];
        const COUNT = 130; // 少し控えめ

        const rand = (min, max) => Math.random() * (max - min) + min;

        for (let i = 0; i < COUNT; i++) {
            pieces.push({
                x: rand(0, W()),
                y: rand(-H(), 0),
                w: rand(6, 12),
                h: rand(8, 16),
                vy: rand(1.2, 3.0),
                vx: rand(-0.6, 0.6),
                rot: rand(0, Math.PI * 2),
                vr: rand(-0.08, 0.08),
                color: colors[(Math.random() * colors.length) | 0],
            });
        }

        // 3秒後に少し落ち着かせる（負荷軽減）
        setTimeout(() => {
            pieces.forEach(p => { p.vy *= 0.75; p.vx *= 0.75; });
        }, 3000);

        function draw() {
            ctx.clearRect(0, 0, W(), H());

            for (const p of pieces) {
                p.y += p.vy;
                p.x += p.vx;
                p.rot += p.vr;

                if (p.y > H() + 20) { p.y = -20; p.x = rand(0, W()); }
                if (p.x < -20) p.x = W() + 20;
                if (p.x > W() + 20) p.x = -20;

                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rot);
                ctx.globalAlpha = 0.9;
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                ctx.restore();
            }

            requestAnimationFrame(draw);
        }

        draw();
    })();
</script>

{% endblock %}